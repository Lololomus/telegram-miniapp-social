<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title data-i18n-key="my_profile">Мой профиль</title>

    <!-- ИЗМЕНЕНИЕ: TomSelect УДАЛЕН -->
    <link rel="stylesheet" href="/css/style.css?v=1.3">
    <script src="https://cdn.jsdelivr.net/npm/davidshimjs-qrcodejs@0.0.2/qrcode.min.js"></script>
    
    <!-- ИЗМЕНЕНИЕ: TomSelect УДАЛЕН -->
</head>
<body>

    <div class="glass-background"></div>

    <div id="welcome-container" class="screen" style="display: none;">
        <div class="welcome-card">
            <h2 data-i18n-key="welcome_title">Добро пожаловать!</h2>
            <p data-i18n-key="welcome_p">Создайте свой публичный профиль...</p>
            <button id="create-profile-button" class="action-button" data-i18n-key="create_profile">Создать профиль</button>
        </div>
    </div>

    <div id="form-container" class="screen" style="display: none;">
        <div class="form-header">
            <h1 data-i18n-key="your_profile">Ваш профиль</h1>
            <!-- ✅ ИЗМЕНЕНИЕ (Fullscreen Nav): Кнопка "Назад" удалена -->
            <!-- <button id="back-to-profile-from-edit-button" ... > ... </button> -->
        </div>
        <div class="avatar-upload">
            <img id="avatar-preview" src="https://t.me/i/userpic/320/null.jpg" alt="Preview">
            <div class="upload-overlay">
                <label for="photo-input" class="upload-button">📸</label>
            </div>
            <input type="file" id="photo-input" accept="image/jpeg, image/png" style="display: none;">
        </div>
        <div class="form-group">
            <label for="name-field" data-i18n-key="name_label">Имя:</label>
            <input type="text" id="name-field" data-i18n-placeholder="name_placeholder">
        </div>
        <div class="form-group">
            <label for="bio-field" data-i18n-key="bio_label">О себе:</label>
            <textarea id="bio-field" data-i18n-placeholder="bio_placeholder"></textarea>
        </div>
        
        <div class="form-group">
            <label for="skills-field" data-i18n-key="skills_label">Ключевые навыки:</label>
            <div class="skills-input-group">
                <input type="text" id="skills-field" data-i18n-placeholder="skills_placeholder">
                <button type="button" id="open-skills-modal-button" class="skills-input-button" aria-label="Выбрать навыки">
                    <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path d="M10 7h8M10 12h8M10 17h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                        <circle cx="6" cy="7" r="1.5" fill="currentColor"></circle>
                        <circle cx="6" cy="12" r="1.5" fill="currentColor"></circle>
                        <circle cx="6" cy="17" r="1.5" fill="currentColor"></circle>
                    </svg>
                    <span class="sr-only">Выбрать навыки</span>
                </button>
            </div>
        </div>
        <div class="form-section">
            <h2 data-i18n-key="links_section_title">Ссылки</h2>
            <div id="links-container">
                </div>
            <button type="button" id="add-link-button" class="add-item-button" data-i18n-key="add_link_button">+ Добавить ссылку</button>
        </div>
        <div class="form-section">
            <h2 data-i18n-key="experience_section_title">Опыт работы</h2>
            <div id="experience-container">
                </div>
            <button type="button" id="add-experience-button" class="add-item-button" data-i18n-key="add_experience_button">+ Добавить место работы</button>
        </div>
        <div class="form-section">
            <h2 data-i18n-key="education_section_title">Образование</h2>
            <div id="education-container">
                </div>
            <button type="button" id="add-education-button" class="add-item-button" data-i18n-key="add_education_button">+ Добавить место учебы</button>
        </div>
    </div>

    <div id="profile-view-container" class="screen" style="display: none;">
        <div class="profile-card">
            <button id="show-qr-button" class="icon-button qr-icon" data-i18n-key="qr_button" aria-label="QR-код"> QR <span class="sr-only">QR-код</span></button>
            <button id="share-button" class="icon-button share-icon" aria-label="Поделиться">
                 <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M13 17l5-5-5-5"></path><path d="M6 18v-2a4 4 0 0 1 4-4h8"></path></svg>
                <span class="sr-only">Поделиться</span>
            </button>
            <button id="logout-button" class="icon-button edit-icon" aria-label="Редактировать">
                <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                <span class="sr-only">Редактировать</span>
            </button>
            <button id="settings-button" class="icon-button settings-icon" aria-label="Настройки">
                <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M12 8.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7z" fill="none" stroke="currentColor" stroke-width="1.8"></path><path d="M12 3v2M12 19v2M4.9 7l1.4 1.4M17.7 16.2l1.4 1.4M3 12h2M19 12h2M4.9 17l1.4-1.4M17.7 7.8l1.4-1.4" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"></path></svg>
                <span class="sr-only">Настройки</span>
            </button>
            <div class="profile-avatar-container">
                <img id="profile-avatar" src="https://t.me/i/userpic/320/null.jpg" alt="Avatar">
            </div>
            
            <h2 id="profile-username"></h2>
            
            <div id="profile-stats" class="profile-stats-container">
                <div class="stat-item" id="profile-followers"><span class="stat-value">0</span><span class="stat-label" data-i18n-key="followers">Подписчики</span></div>
                <div class="stat-item" id="profile-following"><span class="stat-value">0</span><span class="stat-label" data-i18n-key="following">Подписки</span></div>
                </div>

            <p id="profile-bio"></p>
            <div id="profile-skills" class="skills-container"></div>
            <div class="show-more-skills-container">
                <button id="profile-skills-toggle" class="show-more-skills-button" style="display: none;"><span>Показать еще</span> <span class="arrow"></span></button>
            </div>
            <div id="profile-experience" class="profile-section"></div>
            <div id="profile-education" class="profile-section"></div>
            <div id="profile-links" class="profile-links"></div>
        </div>
        
        <div class="fab-main-container">
            <button id="view-feed-button" class="fab-main-button action-button">
                <span data-i18n-key="feed_people">👥 Люди</span>
            </button>
            
            <button id="view-posts-feed-button" class="fab-main-button action-button">
                <span data-i18n-key="feed_posts">🚀 Запросы</span>
            </button>
        </div>
    </div>

    <div id="feed-container" class="screen" style="display: none;">
        <div class="feed-header">
            <h1 data-i18n-key="feed_title">Лента</h1>
            <!-- ✅ ИЗМЕНЕНИЕ (Fullscreen Nav): Кнопка "Назад" удалена -->
            <!-- <button id="back-to-profile-button" ... > ... </button> -->
        </div>
        <div class="feed-filter skills-input-group">
            <input type="text" id="feed-search-input" data-i18n-placeholder="search_placeholder">
            
            <button type="button" id="open-skills-modal-button-feed" class="skills-input-button" aria-label="Фильтр по навыкам">
                <svg viewBox="0 0 24 24"><path d="M10 7h8M10 12h8M10 17h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path><circle cx="6" cy="7" r="1.5" fill="currentColor"></circle><circle cx="6" cy="12" r="1.5" fill="currentColor"></circle><circle cx="6" cy="17" r="1.5" fill="currentColor"></circle></svg>
            </button>
        </div>
        <div id="feed-quick-filters" class="quick-filters"></div>
        <div id="feed-list" class="feed-list">
            </div>
    </div>

    <div id="posts-feed-container" class="screen" style="display: none;">
        <div class="feed-header">
            <h1 data-i18n-key="feed_posts_title">Лента запросов</h1>
            
            <!-- ✅ ИЗМЕНЕНИЕ (Fullscreen Nav): Кнопка "Все запросы" удалена -->
            <!-- <button id="back-to-all-posts-button" ... > ... </button> -->
            
            <!-- ✅ ИЗМЕНЕНИЕ (Fullscreen Nav): Кнопка "Мой профиль" удалена -->
            <!-- <button id="back-to-profile-from-posts-button" ... > ... </button> -->
        </div>
        
        <div class="feed-filter skills-input-group">
            <input type="text" id="posts-search-input" data-i18n-placeholder="search_placeholder_posts">
            
            <input type="hidden" id="posts-status-filter-input">

            <button type="button" id="open-skills-modal-button-posts" class="skills-input-button" aria-label="Фильтр по навыкам">
                <svg viewBox="0 0 24 24"><path d="M10 7h8M10 12h8M10 17h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path><circle cx="6" cy="7" r="1.5" fill="currentColor"></circle><circle cx="6" cy="12" r="1.5" fill="currentColor"></circle><circle cx="6" cy="17" r="1.5" fill="currentColor"></circle></svg>
            </button>
        </div>
        
        <div id="posts-quick-filters" class="quick-filters"></div>
        
        <div id="posts-list" class="feed-list">
            </div>

        </div>
    <div id="user-detail-container" class="screen" style="display: none;">
        <div class="feed-header detail-header">
            <!-- ✅ ИЗМЕНЕНИЕ (Fullscreen Nav): Кнопка "Назад" удалена -->
            <!-- <button id="detail-header-back-button" ... > ... </button> -->
            <h1 data-i18n-key="profile_title" style="opacity: 0.7;">Профиль</h1>
            <button id="detail-header-actions-button" class="header-icon-button" aria-label="Дополнительно"><svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><circle cx="12" cy="6" r="1.5" fill="currentColor"></circle><circle cx="12" cy="12" r="1.5" fill="currentColor"></circle><circle cx="12" cy="18" r="1.5" fill="currentColor"></circle></svg><span class="sr-only">Дополнительно</span></button>
        </div>
        <div class="profile-card detail-card-content">
            <div class="detail-avatar-container"><img id="detail-avatar" src="https://t.me/i/userpic/320/null.jpg" alt="Avatar"></div>
            
            <h2 id="detail-username"></h2>
            
            <p id="detail-bio"></p>
            <div id="detail-stats" class="profile-stats-container">
                <div class="stat-item" id="detail-followers"><span class="stat-value">0</span><span class="stat-label" data-i18n-key="followers">Подписчики</span></div>
                <div class="stat-item" id="detail-following"><span class="stat-value">0</span><span class="stat-label" data-i18n-key="following">Подписки</span></div>
                </div>
            <div id="detail-skills" class="skills-container"></div>
            <div class="show-more-skills-container"><button id="detail-skills-toggle" class="show-more-skills-button" style="display: none;"><span>Показать еще</span> <span class="arrow"></span></button></div>
            <div id="detail-experience" class="profile-section"></div>
            <div id="detail-education" class="profile-section"></div>
            <div id="detail-links" class="profile-links"></div>
        </div>
        <div id="detail-fab-container" class="fab-container">
            <button id="fab-contact-button" class="fab-button fab-secondary" title="Написать"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg></button>
            <button id="fab-follow-button" class="fab-button fab-primary" title="Подписаться"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="17" y1="11" x2="23" y2="11"></line></svg></button>
        </div>
    </div>

    <div id="settings-container" class="screen" style="display: none;">
        <div class="form-header">
            <h1 data-i18n-key="settings_title">Настройки</h1>
            <!-- ✅ ИЗМЕНЕНИЕ (Fullscreen Nav): Кнопка "Назад" удалена -->
            <!-- <button id="back-to-profile-from-settings-button" ... > ... </button> -->
        </div>
        <div class="settings-group">
            <label data-i18n-key="language_label">Язык</label>
            <div class="language-options">
                <button id="lang-btn-ru" class="language-option-button" data-lang="ru">Русский</button>
                <button id="lang-btn-en" class="language-option-button" data-lang="en">English</button>
            </div>
        </div>
        
        <div id="glass-toggle-wrapper" class="settings-group glass-toggle-group">
            <label data-i18n-key="glass_mode_label">Режим 'Стекло' (Beta)</label>
            <div class="toggle-switch">
                <input type="checkbox" id="glass-toggle-switch" class="toggle-switch-checkbox">
                <label for="glass-toggle-switch" class="toggle-switch-label"></label>
            </div>
        </div>
        
        <div class="settings-group">
            <label data-i18n-key="theme_label">Тема оформления</label>
            <div class="theme-options">
                <button id="theme-btn-auto" class="theme-option-button" data-theme="auto" data-i18n-key="theme_auto">Авто</button>
                <button id="theme-btn-light" class="theme-option-button" data-theme="light" data-i18n-key="theme_light">Светлая</button>
                <button id="theme-btn-dark" class="theme-option-button" data-theme="dark" data-i18n-key="theme_dark">Темная</button>
                <button id="theme-btn-custom" class="theme-option-button" data-theme="custom" data-i18n-key="theme_custom">Своя</button>
            </div>
        </div>
        <div id="custom-theme-group" class="settings-group" style="display: none;">
            <label data-i18n-key="custom_theme_label">Своя тема</label>
            <div class="color-picker-row">
                <span data-i18n-key="color_bg">Цвет фона</span>
                <input type="color" id="color-input-bg" value="#FFFFFF">
            </div>
            <div class="color-picker-row">
                <span data-i18n-key="color_button">Цвет кнопок</span>
                <input type="color" id="color-input-button" value="#007AFF">
            </div>
            <div class="color-picker-row">
                <span data-i18n-key="color_text">Цвет текста</span>
                <input type="color" id="color-input-text" value="#000000">
            </div>
            <button id="save-custom-theme-button" class="action-button" data-i18n-key="apply_and_save">Применить и сохранить</button>
        </div>
    </div>

    <div id="loading-spinner" class="spinner"></div>

    <div id="qr-code-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2 data-i18n-key="qr_title">QR-код вашего профиля</h2>
            <div id="qrcode-output"></div>
            <p id="qr-link-display"></p>
            <button id="close-qr-modal-button" class="action-button secondary" data-i18n-key="close">Закрыть</button>
        </div>
    </div>

    <div id="skills-modal" class="screen" style="display: none;">
        <div class="form-header">
            <h1 data-i18n-key="skills_modal_title">Выберите навыки</h1>
            <!-- ✅ ИЗМЕНЕНИЕ (Fullscreen Nav): Кнопка "Отмена" удалена -->
            <!-- <button id="close-skills-modal-button" ... > ... </button> -->
        </div>
        
        <div id="status-filter-container" class="status-filter-group" style="display: none;">
            </div>

        <div id="skills-modal-list-container">
            </div>
        
        <div class="fab-modal-save-container">
            <button id="save-skills-modal-button" class="action-button fab-modal-save" data-i18n-key="select">Выбрать</button>
        </div>
    </div>
    
    <div id="create-post-modal" class="screen" style="display: none;">
    <div class="form-header">
        <!-- ИЗМЕНЕНИЕ: Починен ключ "newpost" -> "create_post_title" -->
        <h1 data-i18n-key="create_post_title">Новый запрос</h1>
        <!-- ✅ ИЗМЕНЕНИЕ (Fullscreen Nav): Кнопка "Отмена" удалена -->
        <!-- <button id="close-post-modal-button" ... > ... </button> -->
    </div>

    <div class="form-content">
        <div class="form-group">
        <!-- ИЗМЕНЕНИЕ: Починен ключ "posttype" -> "post_type_label" -->
        <label for="post-type-select" data-i18n-key="post_type_label">Тип запроса:</label>
        <select id="post-type-select">
            <option value="looking">🤝 Ищу специалиста</option>
            <option value="offering">💼 Предлагаю услуги</option>
            <option value="showcase">🚀 Демонстрация</option>
        </select>
        </div>

        <div class="form-group">
        <!-- ИЗМЕНЕНИЕ: Починен ключ "postbriefdescription" -> "post_content_label" -->
        <label for="post-content-field" data-i18n-key="post_content_label">Краткое описание:</label>
        <!-- ИЗМЕНЕНИЕ: Починен ключ "postcontentplaceholder" -> "post_content_placeholder" -->
        <textarea id="post-content-field" rows="3" data-i18n-placeholder="post_content_placeholder"></textarea>
        </div>

        <div class="form-group">
        <!-- ИЗМЕНЕНИЕ: Починен ключ "postfulldescription" -> "post_full_description_label" -->
        <label for="post-full-description-field" data-i18n-key="post_full_description_label">Полное описание (необязательно):</label>
        <!-- ИЗМЕНЕНИЕ: Починен ключ "postfulldescriptionplaceholder" -> "post_full_description_placeholder" -->
        <textarea id="post-full-description-field" rows="5" data-i18n-placeholder="post_full_description_placeholder"></textarea>
        </div>

        <div class="form-group">
        <!-- ИЗМЕНЕНИЕ: Починен ключ "posttags" -> "post_skills_label" -->
        <label for="post-skills-field" data-i18n-key="post_skills_label">Теги (навыки):</label>
        
        <div class="skills-input-group">
            <!-- ИЗМЕНЕНИЕ: Убран 'readonly' -->
            <!-- ИЗМЕНЕНИЕ: Починен ключ "postskillsplaceholder" -> "skills_placeholder_posts" -->
            <input type="text" id="post-skills-field" data-i18n-placeholder="skills_placeholder_posts" />
            <button type="button" id="select-post-skills-button" class="skills-input-button" aria-label="Выбрать навыки">
                <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M10 7h8M10 12h8M10 17h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                    <circle cx="6" cy="7" r="1.5" fill="currentColor"></circle>
                    <circle cx="6" cy="12" r="1.5" fill="currentColor"></circle>
                    <circle cx="6" cy="17" r="1.5" fill="currentColor"></circle>
                </svg>
            </button>
        </div>
        
        </div>
    </div><div class="fab-modal-save-container">
        <button id="save-post-button" class="action-button" data-i18n-key="publish">Опубликовать</button>
    </div>
    </div>
    <template id="skeleton-card-template">
        <div class="skeleton-card">
            <div class="skeleton-avatar"></div>
            <div class="skeleton-info">
                <div class="skeleton-line"></div>
                <div class="skeleton-line short"></div>
            </div>
        </div>
    </template>

    <template id="link-template">
        <div class="dynamic-item link-item">
            <input type="text" class="link-input" placeholder="https://example.com">
            <button type="button" class="delete-item-button" title="Удалить ссылку">×</button>
        </div>
    </template>
    
    <template id="experience-template">
        <div class="dynamic-item experience-item">
            <button type="button" class="delete-item-button" title="Удалить опыт">×</button>
            <div class="form-group"><label data-i18n-key="job_title_label">Должность:</label><input type="text" class="experience-job-title" data-i18n-placeholder="job_title_placeholder"></div>
            <div class="form-group"><label data-i18n-key="company_label">Компания:</label><input type="text" class="experience-company" data-i18n-placeholder="company_placeholder"></div>
            <div class="form-group date-group"><div class="date-input-group"><label data-i18n-key="start_date_label">Дата начала:</label><input type="text" class="experience-start-date" data-i18n-placeholder="date_placeholder" placeholder="ГГГГ или ММ.ГГГГ"></div><div class="date-input-group"><label data-i18n-key="end_date_label">Дата окончания:</label><input type="text" class="experience-end-date" data-i18n-placeholder="date_placeholder" placeholder="ГГГГ или ММ.ГГГГ"><label class="checkbox-label"><input type="checkbox" class="experience-is-current"> <span data-i18n-key="present_time_label">По наст. время</span></label></div></div>
            <div class="form-group"><label data-i18n-key="description_label">Описание:</label><textarea class="experience-description" data-i18n-placeholder="description_placeholder_exp"></textarea></div>
        </div>
    </template>
    
    <template id="education-template">
        <div class="dynamic-item education-item">
             <button type="button" class="delete-item-button" title="Удалить образование">×</button>
             <div class="form-group"><label data-i18n-key="institution_label">Учебное заведение:</label><input type="text" class="education-institution" data-i18n-placeholder="institution_placeholder"></div>
             <div class="form-group"><label data-i18n-key="degree_label">Степень/Квалификация:</label><input type="text" class="education-degree" data-i18n-placeholder="degree_placeholder"></div>
             <div class="form-group"><label data-i18n-key="field_of_study_label">Специальность:</label><input type="text" class="education-field-of-study" data-i18n-placeholder="field_of_study_placeholder"></div>
             <div class="form-group date-group"><div class="date-input-group"><label data-i18n-key="start_date_label">Год начала:</label><input type="text" class="education-start-date" data-i18n-placeholder="year_placeholder" placeholder="ГГГГ"></div><div class="date-input-group"><label data-i18n-key="end_date_label">Год окончания:</label><input type="text" class="education-end-date" data-i18n-placeholder="year_placeholder" placeholder="ГГГГ"></div></div>
             <div class="form-group"><label data-i18n-key="description_label">Описание:</label><textarea class="education-description" data-i18n-placeholder="description_placeholder_edu"></textarea></div>
        </div>
    </template>
    <div id="toast-container"></div> 
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <script type="module" src="/js/app.js?v=1.3"></script>
</body>
</html>