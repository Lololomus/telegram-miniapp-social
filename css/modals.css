/* css/modals.css */
/* ИЗМЕНЕНО: Удалены дублирующиеся стили тегов */
/* ОБНОВЛЕНО (Glass): Добавлены "стеклянные" стили для модалок */
/* ✅ ИСПРАВЛЕНИЕ (Glass): Добавлены стили для React-модалок */
/* ✅ ИСПРАВЛЕНИЕ (Swipe): Добавлены стили для кнопки "Закрыть" */
/* ✅ ИСПРАВЛЕНИЕ #8: Добавлены стили для "плавающего" шеврона */
/* ✅ ИСПРАВЛЕНИЕ #2: Добавлен .overflow-visible-sheet */
/* ✅ ИСПРАВЛЕНИЕ (Проблема 3): Полностью переработан #skills-modal для исправления прокрутки */
/* ✅ ИСПРАВЛЕНИЕ (Проблема 4): Удален фон у .react-sheet-footer */
/* --- ИЗМЕНЕНИЕ: Полностью удалены стили TomSelect --- */

/* --- СТИЛИ: МОДАЛЬНОЕ ОКНО QR-КОДА --- */
.modal-overlay {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.6);
    display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px;
}
.modal-content {
    background-color: var(--main-bg-color, var(--tg-theme-bg-color, #ffffff));
    padding: 25px; border-radius: 14px; text-align: center; max-width: 90%;
    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.15);
    transition: background-color 0.3s, border-color 0.3s, box-shadow 0.3s;
}
#qrcode-output {
    margin: 20px auto; width: 200px; height: 200px; background-color: white;
    padding: 10px; border-radius: 8px; display: flex; align-items: center; justify-content: center;
}
#qrcode-output img { display: block; max-width: 100%; max-height: 100%; }
#qr-link-display {
    font-size: 12px; color: var(--main-hint-color, var(--tg-theme-hint-color, #999999));
    opacity: var(--main-hint-opacity, 1); word-break: break-all; margin-bottom: 20px;
}
.modal-content .action-button.secondary { margin-top: 15px; }

/* --- Стили для модального окна навыков --- */
/* ✅ ИСПРАВЛЕНИЕ (Проблема 3): Меняем позиционирование и убираем padding */
#skills-modal {
    display: none; 
    flex-direction: column; 
    /* height: 100%; */ /* <-- УДАЛЕНО */
    
    /* --- ДОБАВЛЕНО --- */
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    /* Используем dvh (dynamic viewport height) для мобильных, с фоллбэком на vh */
    height: 100dvh; 
    height: 100vh; /* Фоллбэк */
    z-index: 1001; /* Выше, чем .react-sheet-content (1000) */
    padding: 0; /* <-- УБИРАЕМ PADDING, который был у .screen */
    /* --- КОНЕЦ --- */
    
    background-color: var(--main-bg-color, var(--tg-theme-bg-color, #ffffff));
    transition: background-color 0.3s;
}
/* --- КОНЕЦ ИСПРАВЛЕНИЯ --- */

/* ✅ ИСПРАВЛЕНИЕ (Проблема 3): Добавляем padding сюда */
#skills-modal .form-header {
    padding: 20px 20px 10px 20px;
    margin-bottom: 0; /* Убираем, т.к. фильтр будет следующим */
    flex-shrink: 0; /* Не сжимать заголовок */
}

#skills-modal-list-container {
  flex-grow: 1;
  overflow-y: auto;
  border-radius: 10px;
  padding: 0 20px;
  margin: 0;
  min-height: 0; /* ВАЖНО для flex-grow в Safari */
  padding-bottom: 120px; /* Увеличиваем, чтобы контент не заходил под кнопку */
  background-color: var(--main-bg-color, var(--tg-theme-bg-color, #ffffff));
  border: none;
  transition: background-color 0.3s;
}

/* --- Стили для ВЫБОРА навыков (в модальном окне) --- */
.skill-category {
    /* ✅ ИСПРАВЛЕНИЕ (Проблема 3): Убираем padding отсюда */
    margin-bottom: 20px; 
    padding: 0;
}
.skill-category:last-child { margin-bottom: 0; }
.skill-category-title {
    font-size: 15px; font-weight: 600;
    color: var(--main-hint-color, var(--tg-theme-hint-color, #999999));
    margin: 0 0 12px 0; padding-bottom: 8px; border-bottom: none;
}
.skill-list { display: flex; flex-wrap: wrap; gap: 10px; }

/* УДАЛЕНЫ БЛОКИ:
   .skill-selectable-tag 
   .skill-selectable-tag.selected 
   Они теперь определены в /css/components/tags.css 
*/


/* (ИСПРАВЛЕНО) Новый контейнер для позиционирования */
.fab-modal-save-container {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 40px); /* 20px отступ с каждой стороны */
    max-width: 560px; /* 600px (max-width .screen) - 40px */
    z-index: 1001; /* Выше, чем .modal-overlay */
}

/* (ИСПРАВЛЕНО) Кнопка теперь наследует ширину 
   контейнера и может спокойно анимироваться */
.action-button.fab-modal-save {
    width: 100%; /* Занимает всю ширину контейнера */
    
    /* Анимация пульсации для привлечения внимания */
    animation: fab-pulse-main 2.5s infinite ease-in-out;
    
    /* Явно переопределяем padding, 
       чтобы кнопка была как в action-button */
    padding: 14px;
    
    /* Сбрасываем позиционирование, т.к. оно на контейнере */
    position: relative;
    left: auto;
    bottom: auto;
    transform: none; 
}

/* --- Стили для нового фильтра статусов --- */
.status-filter-group {
    /* ✅ ИСПРАВЛЕНИЕ (Проблема 3): Добавляем padding сюда */
    padding: 0 20px; /* Синхронизируем с .form-header */
    margin-bottom: 15px;
    border-bottom: 1.5px solid var(--secondary-bg-color, var(--tg-theme-secondary-bg-color, #efefef));
    padding-bottom: 20px;
    transition: border-color 0.3s;
    flex-shrink: 0; /* Не сжимать фильтр */
}
.status-filter-group-title {
    font-size: 15px;
    font-weight: 600;
    color: var(--main-hint-color, var(--tg-theme-hint-color, #999999));
    margin: 0 0 12px 0;
}
.status-filter-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

/* Стили для самих кнопок статуса */
.status-tag {
    cursor: pointer;
    padding: 8px 14px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    border: 1.5px solid transparent;
    transition: background-color 0.2s, color 0.2s, border-color 0.2s;
    
    /* Стили по умолчанию (неактивный) */
    background-color: var(--secondary-bg-color, var(--tg-theme-secondary-bg-color, #efefef));
    color: var(--main-text-color, var(--tg-theme-text-color, #000000));
}

/* Активное состояние (когда выбран) */
.status-tag.active {
    color: #ffffff;
    border-color: transparent !important; /* Убедимся, что рамки нет */
}

/* Стилизация под конкретные типы */
.status-tag[data-status="looking"] {
    border-color: #0A84FF;
    color: #0A84FF;
}
.status-tag[data-status="looking"].active {
    background-color: #0A84FF;
}

.status-tag[data-status="offering"] {
    border-color: #34C759;
    color: #34C759;
}
.status-tag[data-status="offering"].active {
    background-color: #34C759;
}

.status-tag[data-status="showcase"] {
    border-color: #FF9500;
    color: #FF9500;
}
.status-tag[data-status="showcase"].active {
    background-color: #FF9500;
}

/* Переопределения для темной темы */
body.theme-dark .status-tag {
    background-color: var(--secondary-bg-color, #2c2c2e);
    color: var(--main-hint-color, #98989e);
}
body.theme-dark .status-tag[data-status="looking"] {
    border-color: #0A84FF;
    color: #0A84FF;
}
body.theme-dark .status-tag[data-status="offering"] {
    border-color: #34C759;
    color: #34C759;
}
body.theme-dark .status-tag[data-status="showcase"] {
    border-color: #FF9500;
    color: #FF9500;
}
body.theme-dark .status-tag.active {
    color: #ffffff;
}

/* --- (НОВЫЙ БЛОК) Стили для "Стекла" (HTML-модалки) --- */
body.theme-glass-overlay .modal-overlay {
    /* Фон оверлея делаем чуть прозрачнее */
    background-color: rgba(0, 0, 0, 0.4);
}
body.theme-glass-overlay .modal-content {
    background-color: var(--glass-bg);
    backdrop-filter: blur(25px);
    -webkit-backdrop-filter: blur(25px);
    border: var(--glass-border);
    box-shadow: var(--glass-shadow);
    border-radius: var(--glass-radius-main);
}

/* --- Стили для модалки создания запроса --- */
#create-post-modal {
  display: none;
  flex-direction: column;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  height: 100dvh;
  height: 100vh; /* Фоллбэк */
  z-index: 1001;
  padding: 0;
  background-color: var(--main-bg-color, var(--tg-theme-bg-color, #ffffff));
  transition: background-color 0.3s;
}

#create-post-modal .form-header {
  padding: 20px 20px 10px 20px;
  margin-bottom: 0;
  flex-shrink: 0;
}

#create-post-modal .form-content {
  flex: 1;
  overflow-y: auto;
  padding: 0 20px;
  padding-bottom: 120px; /* Отступ снизу, чтобы контент не заходил под кнопку */
  min-height: 0;
}

body.theme-glass-overlay #skills-modal,
body.theme-glass-overlay #create-post-modal {
    background-color: transparent; /* Сам экран прозрачный */
}
/* ✅ ИСПРАВЛЕНИЕ (Проблема 3): Добавляем фон контейнеру */
body.theme-glass-overlay #skills-modal,
body.theme-glass-overlay #create-post-modal {
    background-color: var(--main-bg-color); /* Используем фоновый цвет темы */
}
body.theme-glass-overlay.theme-light.theme-glass-overlay #skills-modal,
body.theme-light.theme-glass-overlay #create-post-modal {
    background-color: var(--main-bg-color); /* #ffffff */
}
body.theme-glass-overlay.theme-dark.theme-glass-overlay #skills-modal,
body.theme-dark.theme-glass-overlay #create-post-modal {
    background-color: var(--main-bg-color); /* #1c1c1d */
}
/* --- КОНЕЦ ИСПРАВЛЕНИЯ --- */


body.theme-glass-overlay #skills-modal-list-container {
    background-color: transparent;
}
body.theme-glass-overlay .status-filter-group {
    border-bottom-color: var(--glass-border);
}
body.theme-glass-overlay .status-tag {
    background-color: var(--glass-bg-input);
    border: var(--glass-border);
    color: var(--main-text-color);
    opacity: 0.8;
}
body.theme-glass-overlay .status-tag.active {
    opacity: 1;
    color: #ffffff;
    border-color: transparent;
}
body.theme-glass-overlay .status-tag[data-status="looking"].active {
    background-color: #0A84FF;
}
body.theme-glass-overlay .status-tag[data-status="offering"].active {
    background-color: #34C759;
}
body.theme-glass-overlay .status-tag[data-status="showcase"].active {
    background-color: #FF9500;
}

body.theme-glass-overlay .action-button.fab-modal-save {
    background-color: var(--main-button-color);
    color: var(--main-button-text-color);
    border: none;
    box-shadow: var(--glass-shadow);
}
/* --- КОНЕЦ БЛОКА (HTML-модалки) --- */


/* --- (НОВЫЙ БЛОК) Стили для "Стекла" (React-модалки) --- */

/* Базовые стили для React-модалок (наследуются от base.css .screen) */
.react-sheet-content {
    /* Стили по умолчанию (светлая/авто тема) */
    background-color: var(--secondary-bg-color, #efefef);
    transition: background-color 0.3s;
}

/* ✅ ИСПРАВЛЕНИЕ (Проблема 4): Блок .react-sheet-footer УДАЛЕН */
/*
.react-sheet-footer {
    ...
}
*/

/* ✅ ИСПРАВЛЕНИЕ #2: Убрано. overflow: visible теперь ставится инлайн в JS
.overflow-visible-sheet {
    overflow: visible !important; 
}
*/


/* Темная тема */
/* ✅ ИСПРАВЛЕНИЕ (Проблема 4): Правило изменено, .react-sheet-footer удален */
body.theme-dark .react-sheet-content {
    background-color: var(--secondary-bg-color, #2c2c2e);
}

/* "Стеклянная" тема */
body.theme-glass-overlay .react-sheet-content {
    background-color: var(--glass-bg);
    backdrop-filter: blur(25px);
    -webkit-backdrop-filter: blur(25px);
    border-top: var(--glass-border);
    border-left: var(--glass-border);
    border-right: var(--glass-border);
    box-shadow: var(--glass-shadow);
}
/* ✅ ИСПРАВЛЕНИЕ (Проблема 4): Блок body.theme-glass-overlay .react-sheet-footer УДАЛЕН */

/* Оптимизация для iOS (без размытия) */
body.theme-glass-overlay .react-sheet-content.is-ios {
    background-color: var(--glass-bg-ios-fallback);
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
}
/* ✅ ИСПРАВЛЕНИЕ (Проблема 4): Блок body.theme-glass-overlay .react-sheet-footer.is-ios УДАЛЕН */

/* ✅ НОВОЕ: Стили для кнопки "Закрыть" (крестик) */
.react-sheet-close-button {
    position: absolute;
    top: 16px;
    right: 16px;
    z-index: 10;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    
    /* Стили по умолчанию (светлая/авто тема) */
    background-color: var(--secondary-bg-color, #efefef);
    color: var(--main-hint-color, #999999);
    
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    transition: background-color 0.3s, color 0.3s, opacity 0.2s, transform 0.2s, border-color 0.3s, box-shadow 0.3s;
}
.react-sheet-close-button svg {
    width: 14px;
    height: 14px;
}
.react-sheet-close-button:active {
    transform: scale(0.9);
}

/* Темная тема */
body.theme-dark .react-sheet-close-button {
    background-color: var(--main-bg-color, #1c1c1d);
    color: var(--main-hint-color, #98989e);
}

/* "Стеклянная" тема */
body.theme-glass-overlay .react-sheet-close-button {
    background-color: var(--glass-bg-secondary);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border: var(--glass-border);
    color: var(--main-text-color);
    opacity: 0.8;
}
/* Оптимизация для iOS (без размытия) */
body.theme-glass-overlay .react-sheet-close-button.is-ios {
    background-color: var(--glass-bg-ios-fallback-secondary);
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
}

/* ✅ НОВОЕ: Стили для кнопки "..." (Действия) */
.react-sheet-actions-button {
    position: absolute;
    top: 16px;
    left: 16px; /* <-- Изменено на 'left' */
    z-index: 10;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    
    /* Стили по умолчанию (светлая/авто тема) */
    background-color: var(--secondary-bg-color, #efefef);
    color: var(--main-hint-color, #999999);
    
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    font-size: 20px; /* Для "..." */
    line-height: 1;
    transition: background-color 0.3s, color 0.3s, opacity 0.2s, transform 0.2s, border-color 0.3s, box-shadow 0.3s;
}
.react-sheet-actions-button:active {
    transform: scale(0.9);
}
/* Темная тема */
body.theme-dark .react-sheet-actions-button {
    background-color: var(--main-bg-color, #1c1c1d);
    color: var(--main-hint-color, #98989e);
}
/* "Стеклянная" тема */
body.theme-glass-overlay .react-sheet-actions-button {
    background-color: var(--glass-bg-secondary);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border: var(--glass-border);
    color: var(--main-text-color);
    opacity: 0.8;
}
/* Оптимизация для iOS (без размытия) */
body.theme-glass-overlay .react-sheet-actions-button.is-ios {
    background-color: var(--glass-bg-ios-fallback-secondary);
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
}


/* --- ✅ НОВЫЙ БЛОК: Стили для "Плавающего" Шеврона --- */
.react-sheet-chevron-close {
    position: absolute;
    /* Выносим кнопку НАД карточкой */
    top: -15px; 
    /* Центрируем */
    left: 50%;
    transform: translateX(-50%);
    z-index: 10;
    
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    
    /* Стили по умолчанию (светлая/авто тема) */
    background-color: var(--secondary-bg-color, #efefef);
    color: var(--main-hint-color, #999999);
    border: 1.5px solid var(--main-bg-color, #fff); /* Рамка в цвет фона, чтобы "отделить" */
    box-shadow: 0 -2px 10px rgba(0,0,0,0.08);

    transition: all 0.3s;
}
.react-sheet-chevron-close svg {
    width: 20px;
    height: 20px;
}
.react-sheet-chevron-close:active {
    transform: translateX(-50%) scale(0.9);
}

/* Темная тема */
body.theme-dark .react-sheet-chevron-close {
    background-color: var(--secondary-bg-color, #2c2c2e);
    color: var(--main-hint-color, #98989e);
    border: 1.5px solid var(--main-bg-color, #1c1c1d);
    box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
}

/* "Стеклянная" тема */
body.theme-glass-overlay .react-sheet-chevron-close {
    background-color: var(--glass-bg-secondary);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: var(--glass-border);
    color: var(--main-text-color);
    opacity: 0.9;
    box-shadow: var(--glass-shadow);
}
/* Оптимизация для iOS (без размытия) */
body.theme-glass-overlay .react-sheet-chevron-close.is-ios {
    background-color: var(--glass-bg-ios-fallback-secondary);
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
}

/* --- ИЗМЕНЕНИЕ: Все стили TomSelect удалены отсюда --- */